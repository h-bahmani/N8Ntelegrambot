{
  "name": "docterapotele",
  "nodes": [
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "const store = this.getWorkflowStaticData('global');\nstore.modes = store.modes || {};\n\n// chatId Ø±Ø§ Ø§Ø² Ú†Ù†Ø¯ Ø¬Ø§ Ø§Ù…ØªØ­Ø§Ù† Ù…ÛŒâ€ŒÚ¯ÛŒØ±ÛŒÙ… ØªØ§ Ù‡Ù…ÛŒØ´Ù‡ Ù¾Ø± Ø´ÙˆØ¯\nconst chatId =\n  $json.chatId ??\n  $json.message?.chat?.id ??\n  $('Set (normalize)').item.json.chatId; // Ù†Ø§Ù… Ù†ÙˆØ¯ Ø±Ø§ Ø¯Ù‚ÛŒÙ‚Ø§Ù‹ Ø·Ø¨Ù‚ Ø¨ÙˆÙ…Øª Ø¨Ú¯Ø°Ø§Ø±\n\nif (chatId && store.modes[chatId]) {\n  delete store.modes[chatId];\n}\n\nreturn [{ json: { chatId, cleared: true } }];\n"
      },
      "id": "c209c3f3-5a48-4707-a257-d06fe46c413b",
      "name": "Code (clearModeStatic)",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -832,
        -192
      ]
    },
    {
      "parameters": {
        "updates": [
          "message"
        ],
        "additionalFields": {}
      },
      "id": "dbd01489-e543-4d73-a8d4-9555dfab42ad",
      "name": "Telegram Trigger1",
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.2,
      "position": [
        -1504,
        -48
      ],
      "webhookId": "59a6af1f-e115-4359-bf36-10b8b3f19810",
      "credentials": {
        "telegramApi": {
          "id": "zS0guKfoiHnPek4o",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "values": {
          "number": [
            {
              "name": "chatId",
              "value": "={{ $json.message.chat.id }}"
            }
          ],
          "string": [
            {
              "name": "text",
              "value": "={{ ($json.message.text || '').trim() }}"
            }
          ],
          "boolean": [
            {
              "name": "isReset",
              "value": "={{ /^\\/?(start|new)(?:@\\w+)?\\b/i.test($json.text || '') }}"
            },
            {
              "name": "isModeText",
              "value": "={{ /^\\/mode\\s+text\\b/i.test($json.text || '') }}"
            },
            {
              "name": "isModeVoice",
              "value": "={{ /^\\/mode\\s+voice\\b/i.test($json.text || '') }}"
            },
            {
              "name": "isModeBoth",
              "value": "={{ /^\\/mode\\s+both\\b/i.test($json.text || '') }}"
            }
          ]
        },
        "options": {}
      },
      "id": "54e2e7e6-975e-4ece-bca2-257c495c90e8",
      "name": "Set (normalize)1",
      "type": "n8n-nodes-base.set",
      "typeVersion": 2,
      "position": [
        -1280,
        -48
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "id": "fb77d936-4203-492e-8845-c5653d650cb0",
              "leftValue": "={{ $json.isReset }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "97af5b47-2332-4252-88fc-6ab97257eda5",
      "name": "IF (Reset: /start|/new ?)1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -1072,
        32
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $('Set (normalize)1').item.json.chatId }}",
        "text": "Hi! Iâ€™m Miro. Please share the date and time, the doctor/department, your full name, and your email so I can send the confirmation. ",
        "additionalFields": {}
      },
      "id": "7f8f07e7-e9df-4870-8783-86d0e8de28ce",
      "name": "Telegram: Welcome1",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -624,
        -192
      ],
      "webhookId": "bd8cc878-5c5e-4584-89a1-e49ed393a68e",
      "credentials": {
        "telegramApi": {
          "id": "zS0guKfoiHnPek4o",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "id": "331f7641-7454-470b-a324-2311c66f368a",
              "leftValue": "={{ !!$json.message?.voice || !!$json.message?.audio }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "3ffe3606-b808-420b-9d76-54ea11a92308",
      "name": "IF (hasVoice?)1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -896,
        352
      ]
    },
    {
      "parameters": {
        "keepOnlySet": true,
        "values": {
          "string": [
            {
              "name": "user_text",
              "value": "={{ $json.content?.parts?.[0]?.text || '' }}"
            }
          ],
          "number": [
            {
              "name": "chatId",
              "value": "={{ $('Set (normalize)1').item.json.chatId }}"
            }
          ]
        },
        "options": {}
      },
      "id": "991ce1ea-01e0-4711-8844-ed04405eaeb5",
      "name": "Set (unify-voice)1",
      "type": "n8n-nodes-base.set",
      "typeVersion": 2,
      "position": [
        -224,
        208
      ]
    },
    {
      "parameters": {
        "keepOnlySet": true,
        "values": {
          "string": [
            {
              "name": "user_text",
              "value": "={{ $json.message?.text || $json.text || '' }}"
            }
          ],
          "number": [
            {
              "name": "chatId",
              "value": "={{ $('Set (normalize)1').item.json.chatId }}"
            }
          ]
        },
        "options": {}
      },
      "id": "c5134c8a-9b9f-431c-8d19-762cc3b79869",
      "name": "Set (unify-text)1",
      "type": "n8n-nodes-base.set",
      "typeVersion": 2,
      "position": [
        -640,
        672
      ]
    },
    {
      "parameters": {
        "keepOnlySet": true,
        "values": {
          "string": [
            {
              "name": "reply_text",
              "value": "={{ $json.choices?.[0]?.message?.content || $json.output || $json.text || '' }}"
            }
          ],
          "number": [
            {
              "name": "chatId",
              "value": "={{ $('Telegram Trigger1').item.json.message.chat.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "0730523c-0a15-4b29-8c40-67605290a7aa",
      "name": "Set (prepare-reply)1",
      "type": "n8n-nodes-base.set",
      "typeVersion": 2,
      "position": [
        576,
        608
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $json.chatId }}",
        "text": "={{ $json.reply_text }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "e9601ec8-ae79-4f6d-be9b-1168cebe0e07",
      "name": "Telegram: sendMessage1",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        976,
        400
      ],
      "webhookId": "29be67be-b103-4c21-932a-1b5bbb2d5d3e",
      "credentials": {
        "telegramApi": {
          "id": "zS0guKfoiHnPek4o",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "resource": "audio",
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.0-flash-exp",
          "mode": "list",
          "cachedResultName": "models/gemini-2.0-flash-exp"
        },
        "inputType": "binary",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        -384,
        208
      ],
      "id": "0063b8fd-dcec-46e9-8ebe-18798abd1c71",
      "name": "Transcribe a recording2",
      "credentials": {
        "googlePalmApi": {
          "id": "2OHI1xgLHX52Y4y8",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "resource": "file",
        "fileId": "={{ $json.message.voice.file_id }}",
        "additionalFields": {
          "mimeType": ""
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -736,
        208
      ],
      "id": "dbc51016-cc0c-4e85-839f-156af9110de8",
      "name": "Get a file",
      "webhookId": "983156a8-9883-4dc8-b122-fce784dda5bc",
      "credentials": {
        "telegramApi": {
          "id": "zS0guKfoiHnPek4o",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const item = items[0];\nconst bin = item.binary?.data || item.binary?.file || item.binary?.audio || {};\nconst ext = (bin.fileExtension || '').toLowerCase();\nif (ext === 'oga') { bin.fileExtension = 'ogg'; bin.mimeType = 'audio/ogg'; }\nelse if (!bin.mimeType && ext) { bin.mimeType = `audio/${ext}`; }\nitem.binary = { data: bin };\nreturn item;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -560,
        208
      ],
      "id": "a6fa39bd-d916-4afa-8e73-df6a28685f09",
      "name": "Code1"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.user_text }}",
        "options": {
          "systemMessage": "You are â€œMiroâ€, a friendly booking assistant on Telegram.\n\nOUTPUT RULES\n\nReply only in the same language the user used (if the user writes Persian, reply in Persian).\n\nPlain text only: no emojis, no markdown, no tags, no JSON, no meta or thinking.\n\nKeep replies 1â€“2 short sentences (Ù‡Ø± Ø¬Ù…Ù„Ù‡ Ø­Ø¯Ø§Ú©Ø«Ø± ~25 Ú©Ù„Ù…Ù‡).\n\nIf the user mixes languages, prefer Persian whenever there is Persian in the message.\n\nNever switch language unless the user asks you to.\n\nSCOPE & SLOTS\n\nCollect exactly these items: date, time, doctor OR department (prefer doctor if both provided), full name, email.\n\nDefault timezone: Asia/Tehran. Assume current year.\n\nUnderstand any natural date/time in Persian (e.g. Â«Ø³Ù‡â€ŒØ´Ù†Ø¨Ù‡ Ù‡ÙØªÙ‡ Ø¨Ø¹Ø¯ Ø³Ø§Ø¹Øª Û±Û°Â»). If ambiguous, ask a very brief clarification.\n\nFLOW\n\nGreeting / empty or unclear start:\n\nVery briefly introduce yourself and state why you need the info (Ø¨Ø±Ø§ÛŒ Ø«Ø¨Øª Ù†ÙˆØ¨Øª).\n\nIn ÛŒÚ© Ø¬Ù…Ù„Ù‡ Ú©ÙˆØªØ§Ù‡ Ù‡Ù…Ù‡Ù” Ù…ÙˆØ§Ø±Ø¯ Ù„Ø§Ø²Ù… Ø±Ø§ Ø¨Ú¯Ùˆ (ØªØ§Ø±ÛŒØ®ØŒ Ø³Ø§Ø¹ØªØŒ Ù¾Ø²Ø´Ú©/Ø¨Ø®Ø´ØŒ Ù†Ø§Ù… Ú©Ø§Ù…Ù„ØŒ Ø§ÛŒÙ…ÛŒÙ„).\n\nØ¯Ø± Ø¬Ù…Ù„Ù‡ Ø¯ÙˆÙ… ÙÙ‚Ø· Ø§ÙˆÙ„ÛŒÙ† Ø¢ÛŒØªÙ…Ù Ù„Ø§Ø²Ù… (ØªØ§Ø±ÛŒØ®) Ø±Ø§ Ø¨Ù¾Ø±Ø³.\n\nIf some items are known:\n\nØ®ÛŒÙ„ÛŒ Ú©ÙˆØªØ§Ù‡ Ø¨Ú¯Ùˆ Ú†Ù‡ Ú†ÛŒØ²Ù‡Ø§ÛŒÛŒ Ù‡Ù†ÙˆØ² Ù†Ø¯Ø§Ø±ÛŒÙ…ØŒ Ùˆ ÙÙ‚Ø· Ø¢ÛŒØªÙ… Ø¨Ø¹Ø¯ÛŒ Ø±Ø§ Ø¨Ù¾Ø±Ø³.\n\nÙ‡Ø± Ø¨Ø§Ø± ÛŒÚ© Ø¯Ù„ÛŒÙ„ Ú©ÙˆØªØ§Ù‡ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù† (Ù…Ø«Ù„Ø§Ù‹ Â«Ø¨Ø±Ø§ÛŒ Ø«Ø¨Øª Ø¯Ù‚ÛŒÙ‚Â» ÛŒØ§ Â«Ø¨Ø±Ø§ÛŒ ØªÚ©Ù…ÛŒÙ„ Ù¾Ø±ÙˆÙ†Ø¯Ù‡Â»).\n\nAmbiguity: Ø§Ú¯Ø± ØªØ§Ø±ÛŒØ®/Ø³Ø§Ø¹Øª Ù…Ø¨Ù‡Ù… Ø§Ø³ØªØŒ ÛŒÚ© Ø³Ø¤Ø§Ù„ Ø®ÛŒÙ„ÛŒ Ú©ÙˆØªØ§Ù‡ Ø¨Ø±Ø§ÛŒ Ø´ÙØ§Ùâ€ŒØ³Ø§Ø²ÛŒ Ø¨Ù¾Ø±Ø³.\n\nAll info complete:\n\nÛŒÚ© Ø®Ù„Ø§ØµÙ‡Ù” ÛŒÚ©â€ŒØ®Ø·ÛŒ Ø¨Ø¯Ù‡ Ùˆ ØªØ£ÛŒÛŒØ¯ Ø¨Ø®ÙˆØ§Ù‡ (Ø¨Ù„Ù‡/Ø®ÛŒØ±).\n\nØ§Ú¯Ø± Ø¨Ù„Ù‡: ØªØ£ÛŒÛŒØ¯ Ùˆ ØªÙ…Ø§Ù….\n\nØ§Ú¯Ø± Ø®ÛŒØ±: Ù…Ø­ØªØ±Ù…Ø§Ù†Ù‡ Ù„ØºÙˆ Ú©Ù† Ùˆ Ú¯Ø²ÛŒÙ†Ù‡Ù” Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ø¨Ø®ÙˆØ§Ù‡ ÛŒØ§ Ø¨Ú¯Ùˆ Ù‡Ø± Ø²Ù…Ø§Ù† Ø¢Ù…Ø§Ø¯Ù‡ Ø¨ÙˆØ¯ÛŒØ¯ Ø¨ÙØ±Ù…Ø§ÛŒÛŒØ¯.\n\nOut of scope: Ø®ÛŒÙ„ÛŒ Ú©ÙˆØªØ§Ù‡ ØªÙˆØ¶ÛŒØ­ Ø¨Ø¯Ù‡ Ú©Ù‡ ÙˆØ¸ÛŒÙÙ‡Ù” ØªÙˆ Ø±Ø²Ø±Ùˆ Ù†ÙˆØ¨Øª Ø§Ø³Øª Ùˆ Ø¨Ø§ ÛŒÚ© Ø¬Ù…Ù„Ù‡ Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù† Ø¨Ù‡ Ø±ÙˆÙ†Ø¯ Ø±Ø²Ø±Ùˆ.\n\nEXAMPLES (Persian style)\n\nFirst turn:\nÂ«Ø³Ù„Ø§Ù…! Ù…Ù† Ù…ÛŒØ±Ùˆ Ù‡Ø³ØªÙ…. Ø¨Ø±Ø§ÛŒ Ø±Ø²Ø±Ùˆ Ù†ÙˆØ¨Øª ØªØ§Ø±ÛŒØ®ØŒ Ø³Ø§Ø¹ØªØŒ Ù†Ø§Ù… Ù¾Ø²Ø´Ú© ÛŒØ§ Ø¨Ø®Ø´ØŒ Ù†Ø§Ù… Ú©Ø§Ù…Ù„ Ùˆ Ø§ÛŒÙ…ÛŒÙ„ Ù„Ø§Ø²Ù… Ø§Ø³Øª.\nØ¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ØŒ Ù„Ø·ÙØ§Ù‹ ØªØ§Ø±ÛŒØ® Ù…Ø¯Ù†Ø¸Ø±ØªØ§Ù† Ø±Ø§ Ø¨ÙØ±Ù…Ø§ÛŒÛŒØ¯ (Ø¨Ø±Ø§ÛŒ Ø«Ø¨Øª Ø¯Ù‚ÛŒÙ‚).Â»\n\nAfter date only:\nÂ«Ù…Ù…Ù†ÙˆÙ†. Ø¨Ø±Ø§ÛŒ Ø«Ø¨Øª Ø¯Ù‚ÛŒÙ‚ØŒ Ù„Ø·ÙØ§Ù‹ Ø³Ø§Ø¹Øª Ø±Ø§ Ù‡Ù… Ø¨ÙØ±Ù…Ø§ÛŒÛŒØ¯.Â»\n\nWith remaining items:\nÂ«ÙØ¹Ù„Ø§Ù‹ [ÙÙ‡Ø±Ø³Øª Ú©ÙˆØªØ§Ù‡Ù Ù…ÙˆØ§Ø±Ø¯Ù Ù…Ø§Ù†Ø¯Ù‡ØŒ Ù…Ø«Ù„Ø§Ù‹: Ø³Ø§Ø¹Øª Ùˆ Ø§ÛŒÙ…ÛŒÙ„] Ø±Ø§ Ù†Ø¯Ø§Ø±Ù…. Ù„Ø·ÙØ§Ù‹ [Ø¢ÛŒØªÙ… Ø¨Ø¹Ø¯ÛŒ] Ø±Ø§ Ø¨ÙØ±Ù…Ø§ÛŒÛŒØ¯ (Ø¨Ø±Ø§ÛŒ ØªÚ©Ù…ÛŒÙ„ Ù¾Ø±ÙˆÙ†Ø¯Ù‡).Â»\n\nSummary:\nÂ«Ù†ÙˆØ¨Øª: [ØªØ§Ø±ÛŒØ®] Ø³Ø§Ø¹Øª [Ø³Ø§Ø¹Øª] Ù†Ø²Ø¯ [Ù¾Ø²Ø´Ú©/Ø¨Ø®Ø´] Ø¨Ù‡ Ù†Ø§Ù… [Ù†Ø§Ù… Ú©Ø§Ù…Ù„]. ØªØ£ÛŒÛŒØ¯ Ù…ÛŒâ€ŒÙØ±Ù…Ø§ÛŒÛŒØ¯ØŸÂ»\n\nYes:\nÂ«Ø¹Ø§Ù„ÛŒ! Ù†ÙˆØ¨Øª Ø¨Ø±Ø§ÛŒ [ØªØ§Ø±ÛŒØ®] Ø³Ø§Ø¹Øª [Ø³Ø§Ø¹Øª] Ø«Ø¨Øª Ø´Ø¯. Ø§Ú¯Ø± ØªØºÛŒÛŒØ±ÛŒ Ø®ÙˆØ§Ø³ØªÛŒØ¯ Ù‡Ù…ÛŒÙ†â€ŒØ¬Ø§ Ø¨ÙØ±Ù…Ø§ÛŒÛŒØ¯.Â»\n\nNo:\nÂ«Ø¨Ø§Ø´Ù‡ØŒ Ø±Ø²Ø±Ùˆ Ø§Ù†Ø¬Ø§Ù… Ù†Ø´Ø¯. Ø§Ú¯Ø± Ø²Ù…Ø§Ù† Ø¯ÛŒÚ¯Ø±ÛŒ Ù…Ø¯Ù†Ø¸Ø±ØªØ§Ù† Ø§Ø³Øª Ø¨ÙØ±Ù…Ø§ÛŒÛŒØ¯ ØªØ§ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†Ù….Â»\n\nDO NOT\n\nDo not output JSON, lists of keys, or internal reasoning.\n\nDo not use emojis/markdown.\n\nDo not ask multiple new items at onceâ€”always one missing item per turn.\n\nTIME RULE (Tehran):\n- â€œnowâ€ = current time in Asia/Tehran (Jalali).\n- â€œnext weekâ€ = today + 7 days (Ù†Ø²Ø¯ÛŒÚ©â€ŒØªØ±ÛŒÙ† Ù‡ÙØªÙ‡â€ŒÛŒ Ù¾ÛŒØ´Ù Ø±ÙˆØŒ Ù†Ù‡ Ù…Ø§Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯ÙˆØ±).\n- ØªØ§Ø±ÛŒØ®â€ŒÙ‡Ø§ÛŒ Ù†Ø³Ø¨ÛŒ Ø±Ø§ ÙÙ‚Ø· Ø¨Ø§ Ø±ÙˆØ²Ù Ù‡ÙØªÙ‡/Ø±ÙˆØ²Ù Ù…Ø§Ù‡ Ø§Ø¹Ù„Ø§Ù… Ú©Ù†Ø› Ù†Ø§Ù… Ù…Ø§Ù‡ Ø±Ø§ Ù†Ú¯Ùˆ Ù…Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± Ø®ÙˆØ¯Ø´ Ú¯ÙØªÙ‡ Ø¨Ø§Ø´Ø¯.\n- Ø§Ú¯Ø± Ø§Ø¨Ù‡Ø§Ù… Ø¨ÙˆØ¯ØŒ ÛŒÚ© Ù¾Ø±Ø³Ø´ Ú©ÙˆØªØ§Ù‡ Ø¨Ø±Ø§ÛŒ ØªØ£ÛŒÛŒØ¯ Ø¨Ù¾Ø±Ø³ (Â«Ù…Ù†Ø¸ÙˆØ±ØªØ§Ù† Ù‡ÙØªÙ‡â€ŒÛŒ Ø¨Ø¹Ø¯ Ø§Ø² Ø§Ù…Ø±ÙˆØ² Ø§Ø³ØªØŸÂ»).\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        -48,
        224
      ],
      "id": "661e9957-af44-4ce0-848e-51767b17bb83",
      "name": "AI Agent3"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ String($('Telegram Trigger1').item.json.message.chat.id) }}",
        "contextWindowLength": 15
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        48,
        448
      ],
      "id": "45914e1a-da11-41fd-ab5b-6459d3291169",
      "name": "Simple Memory3"
    },
    {
      "parameters": {
        "operation": "sendAudio",
        "chatId": "={{ $('Telegram Trigger1').item.json.message.chat.id }}",
        "binaryData": true,
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1744,
        640
      ],
      "id": "85e82d0e-6339-4801-8fd2-3a967c24eac4",
      "name": "Send an audio file",
      "webhookId": "31b5d6a3-0444-4eee-be14-9cfab323936e",
      "credentials": {
        "telegramApi": {
          "id": "zS0guKfoiHnPek4o",
          "name": "Telegram account 3"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.cloudflare.com/client/v4/accounts/1f580945b3c30d067a9199c7a5e5d44a/ai/run/@cf/myshell-ai/melotts",
        "sendHeaders": true,
        "specifyHeaders": "json",
        "jsonHeaders": "{\n  \"Authorization\": \"Bearer klkQ2lmkfAXc_2OSyi2uZNQOuqpnJVe-QNZNBotW\",\n  \"Content-Type\": \"application/json\",\n  \"Accept\": \"application/json\"\n}",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ { \"prompt\": $json.text_out, \"format\": \"mp3\", \"speed\": 0.9 } }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1344,
        640
      ],
      "id": "573b53f8-1cf2-45a4-9bb1-bde338ea9cae",
      "name": "HTTP Request5"
    },
    {
      "parameters": {
        "jsCode": "const b64 = $json.result?.audio ?? $json.audio ?? null;\nif (!b64) {\n  return [{ json: { error: 'No audio base64 found', raw: $json } }];\n}\nconst raw = b64.startsWith('data:') ? b64.split(',')[1] : b64;\nconst buf = Buffer.from(raw, 'base64');\n\nreturn [{\n  json: {},\n  binary: {\n    data: {\n      data: buf,\n      fileName: `reply_${Date.now()}.mp3`,\n      mimeType: 'audio/mpeg'\n    }\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1536,
        640
      ],
      "id": "c43a8faa-d7bd-4c17-bdf9-b8f19df8caef",
      "name": "Code9"
    },
    {
      "parameters": {
        "jsCode": "// --- Helpers ---\nconst toObj = (x) => {\n  if (!x) return {};\n  if (typeof x === 'string') {\n    // ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ JSONØ› Ø§Ú¯Ø± Ù†Ø´Ø¯ØŒ Ø¨Ù‡ ØµÙˆØ±Øª Ù…ØªÙ† Ø³Ø§Ø¯Ù‡ Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø§Ù†ÛŒÙ…\n    try { return JSON.parse(x); } catch { return { text: x }; }\n  }\n  return x;\n};\n\nconst get = (obj, path, d = '') => {\n  try { return path.split('.').reduce((o,k)=>o?.[k], obj) ?? d; }\n  catch { return d; }\n};\n\nconst pickFirst = (...cands) => {\n  for (const c of cands) {\n    if (!c) continue;\n    if (typeof c === 'string' && c.trim()) return c.trim();\n    if (typeof c === 'object') {\n      // Ø±Ø§ÛŒØ¬â€ŒØªØ±ÛŒÙ† Ú©Ù„ÛŒØ¯Ù‡Ø§\n      if (typeof c.text === 'string' && c.text.trim()) return c.text.trim();\n      if (typeof c.reply_text === 'string' && c.reply_text.trim()) return c.reply_text.trim();\n      if (typeof c.output === 'string' && c.output.trim()) return c.output.trim();\n      // Ø®Ø±ÙˆØ¬ÛŒ Ø´Ø¨ÛŒÙ‡ OpenAI\n      const mm = get(c, 'choices.0.message.content', '');\n      if (mm) return String(mm).trim();\n      // Ø´Ú©Ù„â€ŒÙ‡Ø§ÛŒ Ø¯ÛŒÚ¯Ø±\n      const m0 = get(c, 'messages.0.content', '');\n      if (m0) return String(m0).trim();\n    }\n    if (typeof c === 'string' && c.trim().startsWith('{')) {\n      try { const j = JSON.parse(c); const r = pickFirst(j); if (r) return r; } catch {}\n    }\n  }\n  return '';\n};\n\n// --- Parse current node payload only ---\nconst raw = $json ?? {};\nconst obj = toObj(raw);\n\n// TEXT Ø¨Ø±Ø§ÛŒ ØªÙ„Ú¯Ø±Ø§Ù…\nlet text = pickFirst(\n  obj, obj.text, obj.reply_text, obj.output,\n  get(obj,'data.text',''),\n  get(obj,'message.content',''),\n  get(obj,'messages.0.content',''),\n  get(obj,'choices.0.message.content',''),\n  typeof raw === 'string' ? raw : ''\n);\n\n// Ø­Ø°Ù Ø¨Ù„Ø§Ú©â€ŒÙ‡Ø§ÛŒ <think>â€¦</think> Ø§Ú¯Ø± ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø´Øª\ntext = String(text).replace(/<think>[\\s\\S]*?<\\/think>/gi,'').trim();\n\n// SPEAK Ø¨Ø±Ø§ÛŒ TTS (Ø§Ú¯Ø± Ù†Ø¨ÙˆØ¯ØŒ Ø§Ø² text)\nlet speak = pickFirst(\n  obj.speak_en, obj.speak, get(obj,'voice',''), get(obj,'audio.prompt','')\n);\nif (!speak) speak = text;\n\n// ØªÙ…ÛŒØ²Ú©Ø§Ø±ÛŒ Ù†Ù‡Ø§ÛŒÛŒ Ø¨Ø±Ø§ÛŒ TTS\nspeak = String(speak).replace(/\\s+/g,' ').trim();\n\n// Ø®Ø±ÙˆØ¬ÛŒ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯\nreturn [{ json: { text, speak } }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        384,
        608
      ],
      "id": "5242cb7f-b147-4fa2-9c32-0dfa9b1fa7a1",
      "name": "Code2"
    },
    {
      "parameters": {
        "sendTo": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('To', ``, 'string') }}",
        "subject": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Subject', ``, 'string') }}",
        "message": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Message', ``, 'string') }}",
        "options": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.gmailTool",
      "typeVersion": 2.1,
      "position": [
        176,
        464
      ],
      "id": "8365e143-9f41-4b76-8c71-73d030ba254b",
      "name": "sendEmail3",
      "webhookId": "347652a6-179f-4c68-8b7b-02bf61c0d282",
      "credentials": {
        "gmailOAuth2": {
          "id": "pkCsHjkXxQUtr9eB",
          "name": "Gmail account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.user_text }}",
        "options": {
          "systemMessage": "You are â€œMiroâ€, a booking assistant for medical appointments on Telegram.\n\nØ²Ø¨Ø§Ù† Ùˆ Ø³Ø¨Ú©\n- Ø¨Ø¨ÛŒÙ† Ø¯Ù‚Øª Ú©Ù† ØªÚ©Ø³Øª Ø±Ø§ Ø¨Ù‡ Ø²Ø¨Ø§Ù† ÙØ§Ø±Ø³ÛŒ ÙÙ‚Ø· Ùˆ ÙÙ‚Ø· ÙØ§Ø±Ø³ÛŒ Ù†ÙˆØ´ØªÙ‡ Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯. Ù„Ø­Ù† ØµÙ…ÛŒÙ…ÛŒØŒ Ú©ÙˆØªØ§Ù‡ Ùˆ Ù…Ø¤Ø¯Ø¨. Ø­Ø¯Ø§Ú©Ø«Ø± Û± Ø§ÛŒÙ…ÙˆØ¬ÛŒ Ø§Ø®ØªÛŒØ§Ø±ÛŒ.\n- Ù‡Ø± Ù¾Ø§Ø³Ø® Ø­ØªÙ…Ø§Ù‹ Û±â€“Û² Ø¬Ù…Ù„Ù‡â€ŒÛŒ Ú©ÙˆØªØ§Ù‡ Ø¨Ø§Ø´Ø¯. Ø¨Ø¯ÙˆÙ† Ù†Ø´Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ ÙÙ†ÛŒØŒ ØªÚ¯â€ŒÙ‡Ø§ØŒ ÛŒØ§ ØªÙˆØ¶ÛŒØ­ ÙØ±Ø§ÛŒÙ†Ø¯.\n\nØ§Ø³Ú©ÙˆÙ¾ (Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§)\n- Ø¯Ù‚ÛŒÙ‚Ø§Ù‹ Ø§ÛŒÙ† Ù…ÙˆØ§Ø±Ø¯ Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ø±Ø²Ø±Ùˆ Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ Ú©Ù†: Û±) ØªØ§Ø±ÛŒØ®ØŒ Û²) Ø³Ø§Ø¹ØªØŒ Û³) Ù†Ø§Ù… Ù¾Ø²Ø´Ú© ÛŒØ§ ÙˆØ§Ø­Ø¯ (ØªØ±Ø¬ÛŒØ­ Ø¨Ø§ Ù¾Ø²Ø´Ú©)ØŒ Û´) Ù†Ø§Ù… Ú©Ø§Ù…Ù„ØŒ Ûµ) Ø§ÛŒÙ…ÛŒÙ„.\n- Ù…Ù†Ø·Ù‚Ù‡ Ø²Ù…Ø§Ù†ÛŒ: Asia/Tehran. Ø³Ø§Ù„ Ø±Ø§ Ø³Ø§Ù„ Ø¬Ø§Ø±ÛŒ ÙØ±Ø¶ Ú©Ù†.\n- ÙˆØ±ÙˆØ¯ÛŒ Ù‡Ø± Ø²Ø¨Ø§Ù†ÛŒ Ø±Ø§ Ø¨ÙÙ‡Ù…ØŒ Ø§Ù…Ø§ Ù‡Ù…ÛŒØ´Ù‡ Ù¾Ø§Ø³Ø® Ø±Ø§ ÙØ§Ø±Ø³ÛŒ Ø¨Ø¯Ù‡. ØªØ§Ø±ÛŒØ®â€ŒÙ‡Ø§ÛŒ Ù…Ø­Ø§ÙˆØ±Ù‡â€ŒØ§ÛŒ (Â«Ø³Ù‡â€ŒØ´Ù†Ø¨Ù‡ Ù‡ÙØªÙ‡ Ø¨Ø¹Ø¯ Ø³Ø§Ø¹Øª Û±Û°Â») Ø±Ø§ ØªÙØ³ÛŒØ± Ú©Ù†.\n\nÙÙ„Ùˆ (Ø¨Ø§ Ø§Ø¹Ù„Ø§Ù… Ù‡Ù…Ù‡â€ŒÛŒ Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§)\n- Ø§Ú¯Ø± Ù¾ÛŒØ§Ù… Ø³Ù„Ø§Ù…/Ù…Ø¨Ù‡Ù…/Ø´Ø±ÙˆØ¹ Ø¨ÙˆØ¯: Ø¯Ø± ÛŒÚ© Ø¬Ù…Ù„Ù‡ Ø®ÛŒÙ„ÛŒ Ú©ÙˆØªØ§Ù‡ Ø¨Ú¯Ùˆ Â«Ø¨Ø±Ø§ÛŒ Ø±Ø²Ø±Ùˆ Ø¨Ù‡ Ø§ÛŒÙ† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù†ÛŒØ§Ø² Ø¯Ø§Ø±ÛŒÙ…: ØªØ§Ø±ÛŒØ®ØŒ Ø³Ø§Ø¹ØªØŒ Ù†Ø§Ù… Ù¾Ø²Ø´Ú© ÛŒØ§ ÙˆØ§Ø­Ø¯ØŒ Ù†Ø§Ù… Ú©Ø§Ù…Ù„ØŒ Ø§ÛŒÙ…ÛŒÙ„Â»Ø› Ø³Ù¾Ø³ Ù‡Ù…Ø§Ù†â€ŒØ¬Ø§ Ø§ÙˆÙ„ÛŒÙ† Ù…ÙˆØ±Ø¯ (ØªØ§Ø±ÛŒØ®) Ø±Ø§ Ø¨Ù¾Ø±Ø³.\n- Ø§Ú¯Ø± Ø¨Ø¹Ø¶ÛŒ Ù…ÙˆØ§Ø±Ø¯ Ø±Ø§ Ø¯Ø§Ø±ÛŒÙ…: ÛŒÚ© Ø¬Ù…Ù„Ù‡â€ŒÛŒ Ú©ÙˆØªØ§Ù‡ Ø¨Ú¯Ùˆ Â«Ø¨Ø±Ø§ÛŒ ØªÚ©Ù…ÛŒÙ„ Ø±Ø²Ø±Ùˆ Ø¨Ù‡ [Ù…ÙˆØ§Ø±Ø¯Ù Ø¨Ø§Ù‚ÛŒÙ…Ø§Ù†Ø¯Ù‡] Ù†ÛŒØ§Ø² Ø¯Ø§Ø±Ù…Â»Ø› Ø³Ù¾Ø³ ÙÙ‚Ø· **ÛŒÚ©** Ù…ÙˆØ±Ø¯Ù Ø¨Ø¹Ø¯ÛŒ Ø±Ø§ Ø¨Ù¾Ø±Ø³.\n- ÙˆÙ‚ØªÛŒ Ù‡Ù…Ù‡â€ŒÛŒ Ù…ÙˆØ§Ø±Ø¯ ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯: Ø®Ù„Ø§ØµÙ‡â€ŒÛŒ ÛŒÚ©â€ŒØ®Ø·ÛŒ Ø¨Ø¯Ù‡ Ùˆ ØªØ£ÛŒÛŒØ¯ (Ø¨Ù„Ù‡/Ø®ÛŒØ±) Ø¨Ú¯ÛŒØ±.\n- Ø§Ú¯Ø± Ø¨Ù„Ù‡: Ø«Ø¨Øª Ø±Ø§ ØªØ£ÛŒÛŒØ¯ Ú©Ù†. Ø§Ú¯Ø± Ø®ÛŒØ±: Ù„ØºÙˆ Ùˆ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ú©Ù…Ú© Ø¨Ø¹Ø¯ÛŒ Ø¨Ø¯Ù‡.\n- Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø®Ø§Ø±Ø¬ Ø§Ø² Ø±Ø²Ø±Ùˆ Ø±Ø§ Ø®ÛŒÙ„ÛŒ Ú©ÙˆØªØ§Ù‡ Ù¾Ø§Ø³Ø® Ø¨Ø¯Ù‡ Ùˆ Ø¨Ù‡ Ø±Ø²Ø±Ùˆ Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†.\n\nÙ†Ù…ÙˆÙ†Ù‡â€ŒÙ‡Ø§\n- Ø´Ø±ÙˆØ¹/Ø³Ù„Ø§Ù…: Â«Ø³Ù„Ø§Ù…! Ø¨Ø±Ø§ÛŒ Ø±Ø²Ø±Ùˆ Ø§ÛŒÙ† Ù…ÙˆØ§Ø±Ø¯ Ù„Ø§Ø²Ù… Ø§Ø³Øª: ØªØ§Ø±ÛŒØ®ØŒ Ø³Ø§Ø¹ØªØŒ Ù†Ø§Ù… Ù¾Ø²Ø´Ú© ÛŒØ§ ÙˆØ§Ø­Ø¯ØŒ Ù†Ø§Ù… Ú©Ø§Ù…Ù„ Ùˆ Ø§ÛŒÙ…ÛŒÙ„. Ø§ÙˆÙ„ ØªØ§Ø±ÛŒØ® Ø±Ø§ Ø¨ÙØ±Ù…Ø§ÛŒÛŒØ¯. ğŸ˜ŠÂ»\n- Ù¾Ø³ Ø§Ø² ØªØ§Ø±ÛŒØ®: Â«Ù…Ù…Ù†ÙˆÙ†ØŒ Ø­Ø§Ù„Ø§ Ø³Ø§Ø¹Øª Ø±Ø§ Ù‡Ù… Ø¨ÙØ±Ù…Ø§ÛŒÛŒØ¯.Â»\n- ÙˆÙ‚ØªÛŒ Ú†Ù†Ø¯ Ù…ÙˆØ±Ø¯ Ù…Ø§Ù†Ø¯Ù‡: Â«Ø¨Ø±Ø§ÛŒ ØªÚ©Ù…ÛŒÙ„ Ø±Ø²Ø±Ùˆ Ø¨Ù‡ [Ø³Ø§Ø¹ØªØŒ Ø§ÛŒÙ…ÛŒÙ„] Ù†ÛŒØ§Ø² Ø¯Ø§Ø±Ù…. Ù„Ø·ÙØ§Ù‹ Ø³Ø§Ø¹Øª Ø±Ø§ Ø¨ÙØ±Ù…Ø§ÛŒÛŒØ¯.Â»\n- Ø¬Ù…Ø¹â€ŒØ¨Ù†Ø¯ÛŒ: Â«Ù†ÙˆØ¨Øª Ø¨Ø±Ø§ÛŒ [ØªØ§Ø±ÛŒØ®] Ø³Ø§Ø¹Øª [Ø³Ø§Ø¹Øª] Ù†Ø²Ø¯ [Ø¯Ú©ØªØ±/ÙˆØ§Ø­Ø¯] Ø¨Ù‡ Ù†Ø§Ù… [Ù†Ø§Ù… Ú©Ø§Ù…Ù„]. ØªØ£ÛŒÛŒØ¯ Ù…ÛŒâ€ŒÚ©Ù†ÛŒØ¯ØŸÂ»\n\nTIME RULE (Tehran):\n- â€œnowâ€ = current time in Asia/Tehran (Jalali).\n- â€œnext weekâ€ = today + 7 days (Ù†Ø²Ø¯ÛŒÚ©â€ŒØªØ±ÛŒÙ† Ù‡ÙØªÙ‡â€ŒÛŒ Ù¾ÛŒØ´Ù Ø±ÙˆØŒ Ù†Ù‡ Ù…Ø§Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯ÙˆØ±).\n- ØªØ§Ø±ÛŒØ®â€ŒÙ‡Ø§ÛŒ Ù†Ø³Ø¨ÛŒ Ø±Ø§ ÙÙ‚Ø· Ø¨Ø§ Ø±ÙˆØ²Ù Ù‡ÙØªÙ‡/Ø±ÙˆØ²Ù Ù…Ø§Ù‡ Ø§Ø¹Ù„Ø§Ù… Ú©Ù†Ø› Ù†Ø§Ù… Ù…Ø§Ù‡ Ø±Ø§ Ù†Ú¯Ùˆ Ù…Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± Ø®ÙˆØ¯Ø´ Ú¯ÙØªÙ‡ Ø¨Ø§Ø´Ø¯.\n- Ø§Ú¯Ø± Ø§Ø¨Ù‡Ø§Ù… Ø¨ÙˆØ¯ØŒ ÛŒÚ© Ù¾Ø±Ø³Ø´ Ú©ÙˆØªØ§Ù‡ Ø¨Ø±Ø§ÛŒ ØªØ£ÛŒÛŒØ¯ Ø¨Ù¾Ø±Ø³ (Â«Ù…Ù†Ø¸ÙˆØ±ØªØ§Ù† Ù‡ÙØªÙ‡â€ŒÛŒ Ø¨Ø¹Ø¯ Ø§Ø² Ø§Ù…Ø±ÙˆØ² Ø§Ø³ØªØŸÂ»).\n\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        -240,
        688
      ],
      "id": "749c0004-7c10-463f-a837-8539010adaca",
      "name": "AI Agent4"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ String($('Telegram Trigger1').item.json.message.chat.id) }}",
        "contextWindowLength": 15
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        -176,
        960
      ],
      "id": "9f421b00-6c18-436f-be70-b48991c361d9",
      "name": "Simple Memory4"
    },
    {
      "parameters": {
        "sendTo": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('To', ``, 'string') }}",
        "subject": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Subject', ``, 'string') }}",
        "message": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Message', ``, 'string') }}",
        "options": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.gmailTool",
      "typeVersion": 2.1,
      "position": [
        -64,
        944
      ],
      "id": "2d1762d6-0184-4894-8ff7-764e90a258fc",
      "name": "sendEmail4",
      "webhookId": "347652a6-179f-4c68-8b7b-02bf61c0d282",
      "credentials": {
        "gmailOAuth2": {
          "id": "pkCsHjkXxQUtr9eB",
          "name": "Gmail account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.reply_text }}",
        "options": {
          "systemMessage": "You translate any input to natural, simple English for TTS.\nOutput only one plain English sentence, without quotes, code fences, or explanations.\nNo Persian. No emojis. Max 120 characters.\n\nØ®Ø±ÙˆØ¬ÛŒ Ø§Øª Ø§ÙÚ©Ø§Ø±Øª Ù†Ø¨Ø§Ø´Ù‡ Ø¨Ù„Ú©Ù‡ Ø¬ÙˆØ§Ø¨ Ø¯Ø±Ø³Øª Ø¨Ø§Ø´Ù‡\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        800,
        640
      ],
      "id": "3de1679d-dcae-462d-b29e-2bd51c7fe542",
      "name": "AI Agent1"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ String($('Telegram Trigger1').item.json.message.chat.id) }}",
        "contextWindowLength": 15
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        896,
        912
      ],
      "id": "517cf9c3-b4db-4470-b6e1-5ab2ace30c2d",
      "name": "Simple Memory5"
    },
    {
      "parameters": {
        "jsCode": "/**\n * Remove <think>...</think> and return a clean one-line English sentence.\n * Input may be in: output | text | choices[0].message.content | message.content\n */\nfunction pick(j){\n  return j?.output\n      ?? j?.text\n      ?? j?.choices?.[0]?.message?.content\n      ?? j?.message?.content\n      ?? '';\n}\n\nlet raw = String(pick($json) || '');\n\nlet clean = raw\n  .replace(/<think>[\\s\\S]*?<\\/think>/gi, '') // remove think blocks\n  .replace(/^[\\s\"'`]+|[\\s\"'`]+$/g, '')      // trim wrapping quotes\n  .replace(/\\s+/g, ' ')                     // collapse spaces\n  .trim();\n\n// Ú©ÙˆØªØ§Ù‡ Ùˆ Ø§Ù…Ù† Ø¨Ø±Ø§ÛŒ TTS\nclean = clean.slice(0, 300);\n\nreturn [{ json: { speak_en: clean, text_out: clean } }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1152,
        640
      ],
      "id": "83475453-6d2a-48fb-984f-5813355b3811",
      "name": "Code3"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        768,
        864
      ],
      "id": "6ba8ced0-df8c-47c9-83fa-2d0356bcb2b0",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "2OHI1xgLHX52Y4y8",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -336,
        960
      ],
      "id": "a93c538a-f2b1-4bda-ab28-c25add5c8514",
      "name": "Google Gemini Chat Model1",
      "credentials": {
        "googlePalmApi": {
          "id": "2OHI1xgLHX52Y4y8",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -112,
        464
      ],
      "id": "5e00bf86-ba61-4dc7-b213-1e5749c6b748",
      "name": "Google Gemini Chat Model2",
      "credentials": {
        "googlePalmApi": {
          "id": "2OHI1xgLHX52Y4y8",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Code (clearModeStatic)": {
      "main": [
        [
          {
            "node": "Telegram: Welcome1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Telegram Trigger1": {
      "main": [
        [
          {
            "node": "Set (normalize)1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set (normalize)1": {
      "main": [
        [
          {
            "node": "IF (Reset: /start|/new ?)1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF (Reset: /start|/new ?)1": {
      "main": [
        [
          {
            "node": "Code (clearModeStatic)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "IF (hasVoice?)1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF (hasVoice?)1": {
      "main": [
        [
          {
            "node": "Get a file",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set (unify-text)1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set (unify-voice)1": {
      "main": [
        [
          {
            "node": "AI Agent3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set (unify-text)1": {
      "main": [
        [
          {
            "node": "AI Agent4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set (prepare-reply)1": {
      "main": [
        [
          {
            "node": "Telegram: sendMessage1",
            "type": "main",
            "index": 0
          },
          {
            "node": "AI Agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Transcribe a recording2": {
      "main": [
        [
          {
            "node": "Set (unify-voice)1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get a file": {
      "main": [
        [
          {
            "node": "Code1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code1": {
      "main": [
        [
          {
            "node": "Transcribe a recording2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent3": {
      "main": [
        [
          {
            "node": "Code2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory3": {
      "ai_memory": [
        [
          {
            "node": "AI Agent3",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request5": {
      "main": [
        [
          {
            "node": "Code9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code9": {
      "main": [
        [
          {
            "node": "Send an audio file",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code2": {
      "main": [
        [
          {
            "node": "Set (prepare-reply)1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "sendEmail3": {
      "ai_tool": [
        [
          {
            "node": "AI Agent3",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent4": {
      "main": [
        [
          {
            "node": "Code2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory4": {
      "ai_memory": [
        [
          {
            "node": "AI Agent4",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "sendEmail4": {
      "ai_tool": [
        [
          {
            "node": "AI Agent4",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent1": {
      "main": [
        [
          {
            "node": "Code3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory5": {
      "ai_memory": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Code3": {
      "main": [
        [
          {
            "node": "HTTP Request5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent4",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent3",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "66004806-dfd4-411c-9bff-95b48fa5e265",
  "meta": {
    "instanceId": "76568b2e87b03c569c3bcd3ca5f38c52a174626ad1b9318aa6505a80b725e542"
  },
  "id": "1N39glIgJ2JzVFi8",
  "tags": []
}
